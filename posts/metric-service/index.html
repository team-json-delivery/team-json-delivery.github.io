<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>모니터링, 알람 그리고 장애들 😊 | Team JSON Delivery</title>
<meta name=keywords content><meta name=description content="Team json delivery는 각자 다른 회사를 다니는 팀원들로 구성되어 있어요.
게임, IT, 금융, 제조업 까지 없는곳이 없어요!
어쩌면 도메인 별로 차이가 있을까요?
모여서 각 회사에서는 어떻게 모니터링을 하고 장애를 관리하는지에 대해
이야기를 나누고 설계를 진행해 보았어요.
1. 🤔 장애가 뭔가요? 장애란, 우리가 쓰는 시스템이나 서비스가 제대로 작동하지 않는 상태를 말해요.
이런 문제는 네트워크가 느리거나 서버에 문제가 생기거나
데이터베이스가 이상한 등 다양한 이유로 생길 수 있어요.
DEVOPS와 microservice로 인한 모듈 파편화에 따라 이러한 모니터링, 또는 관측성이 더욱 중시되고 있어요!"><meta name=author content="zoster0828"><link rel=canonical href=https://team-json-delivery.github.io/posts/metric-service/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.bd435680923be95168ea1b839ff6ad8e781ccaf43d48e00fadcb1ff771ce3c90.css integrity="sha256-vUNWgJI76VFo6huDn/atjngcyvQ9SOAPrcsf93HOPJA=" rel="preload stylesheet" as=style><link rel=icon href=https://team-json-delivery.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://team-json-delivery.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://team-json-delivery.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://team-json-delivery.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://team-json-delivery.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://team-json-delivery.github.io/posts/metric-service/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-Y39RPCVCBC"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Y39RPCVCBC",{anonymize_ip:!1})}</script><meta property="og:title" content="모니터링, 알람 그리고 장애들 😊"><meta property="og:description" content="Team json delivery는 각자 다른 회사를 다니는 팀원들로 구성되어 있어요.
게임, IT, 금융, 제조업 까지 없는곳이 없어요!
어쩌면 도메인 별로 차이가 있을까요?
모여서 각 회사에서는 어떻게 모니터링을 하고 장애를 관리하는지에 대해
이야기를 나누고 설계를 진행해 보았어요.
1. 🤔 장애가 뭔가요? 장애란, 우리가 쓰는 시스템이나 서비스가 제대로 작동하지 않는 상태를 말해요.
이런 문제는 네트워크가 느리거나 서버에 문제가 생기거나
데이터베이스가 이상한 등 다양한 이유로 생길 수 있어요.
DEVOPS와 microservice로 인한 모듈 파편화에 따라 이러한 모니터링, 또는 관측성이 더욱 중시되고 있어요!"><meta property="og:type" content="article"><meta property="og:url" content="https://team-json-delivery.github.io/posts/metric-service/"><meta property="og:image" content="https://team-json-delivery.github.io/images/metric-service/cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-03-09T09:00:00+09:00"><meta property="article:modified_time" content="2024-03-09T09:00:00+09:00"><meta property="og:site_name" content="Team JSON Delivery"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://team-json-delivery.github.io/images/metric-service/cover.png"><meta name=twitter:title content="모니터링, 알람 그리고 장애들 😊"><meta name=twitter:description content="Team json delivery는 각자 다른 회사를 다니는 팀원들로 구성되어 있어요.
게임, IT, 금융, 제조업 까지 없는곳이 없어요!
어쩌면 도메인 별로 차이가 있을까요?
모여서 각 회사에서는 어떻게 모니터링을 하고 장애를 관리하는지에 대해
이야기를 나누고 설계를 진행해 보았어요.
1. 🤔 장애가 뭔가요? 장애란, 우리가 쓰는 시스템이나 서비스가 제대로 작동하지 않는 상태를 말해요.
이런 문제는 네트워크가 느리거나 서버에 문제가 생기거나
데이터베이스가 이상한 등 다양한 이유로 생길 수 있어요.
DEVOPS와 microservice로 인한 모듈 파편화에 따라 이러한 모니터링, 또는 관측성이 더욱 중시되고 있어요!"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://team-json-delivery.github.io/posts/"},{"@type":"ListItem","position":2,"name":"모니터링, 알람 그리고 장애들 😊","item":"https://team-json-delivery.github.io/posts/metric-service/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"모니터링, 알람 그리고 장애들 😊","name":"모니터링, 알람 그리고 장애들 😊","description":"Team json delivery는 각자 다른 회사를 다니는 팀원들로 구성되어 있어요.\n게임, IT, 금융, 제조업 까지 없는곳이 없어요!\n어쩌면 도메인 별로 차이가 있을까요?\n모여서 각 회사에서는 어떻게 모니터링을 하고 장애를 관리하는지에 대해\n이야기를 나누고 설계를 진행해 보았어요.\n1. 🤔 장애가 뭔가요? 장애란, 우리가 쓰는 시스템이나 서비스가 제대로 작동하지 않는 상태를 말해요.\n이런 문제는 네트워크가 느리거나 서버에 문제가 생기거나\n데이터베이스가 이상한 등 다양한 이유로 생길 수 있어요.\nDEVOPS와 microservice로 인한 모듈 파편화에 따라 이러한 모니터링, 또는 관측성이 더욱 중시되고 있어요!","keywords":[],"articleBody":" Team json delivery는 각자 다른 회사를 다니는 팀원들로 구성되어 있어요.\n게임, IT, 금융, 제조업 까지 없는곳이 없어요!\n어쩌면 도메인 별로 차이가 있을까요?\n모여서 각 회사에서는 어떻게 모니터링을 하고 장애를 관리하는지에 대해\n이야기를 나누고 설계를 진행해 보았어요.\n1. 🤔 장애가 뭔가요? 장애란, 우리가 쓰는 시스템이나 서비스가 제대로 작동하지 않는 상태를 말해요.\n이런 문제는 네트워크가 느리거나 서버에 문제가 생기거나\n데이터베이스가 이상한 등 다양한 이유로 생길 수 있어요.\nDEVOPS와 microservice로 인한 모듈 파편화에 따라 이러한 모니터링, 또는 관측성이 더욱 중시되고 있어요!\n2. 🏢 각 회사들은 장애를 어떻게 다루나요? 각 회사마다 장애에 대처하는 자신만의 방식이 있어요.\n어떤 곳은 문제가 터지면 바로 알려줄 수 있는 시스템을 갖추고,\n빨리 해결할 수 있도록 준비하는 곳도 있고요.\n또, 장애에 어떻게 대응할지 프로세스를 확실하게 해두고,\n모든 사람이 뭘 해야 할지 바로 알 수 있게 교육시키는 곳도 있어요 📚.\n어느것이 더 낫다고 할수는 없지만 시스템 규모나 중요도에 따라 적절하게 구성해야 하겠죠.\n장애에 대한 다양한 반응과 대처법 장애에 대한 반응은 사람마다 천차만별이에요. 일부는 담담하게 대응하는 반면, 다른 이들은 긴장하고 불안해할 수도 있어요. 중요한 건, 이런 상황에서 서로를 지지하고 격려하는 것이죠. 긴장하는 이들에게는 특히나 조심스러운 접근이 필요해요. 패닉 상태에 빠지지 않도록 옆에서 함께 문제를 풀어나가며, 마음을 진정시켜주는 게 중요해요. 금융권처럼 높은 스트레스를 받는 환경에서는, 배포 때마다 긴장감이 고조되곤 해요. 여기서는 더욱더 철저한 사전 준비와 서로를 위한 지지가 필요하겠죠. 전사적인 장애 상황이 발생하면, 더 큰 문제로 이어질 수 있어요. 이런 경우에는 전체 팀이 함께 힘을 모아 대응해야 해요. 서비스 회사뿐만 아니라 다른 분야에서도 마찬가지예요. 장애는 언제든 발생할 수 있어요. 하지만 서로를 믿고, 잘 대비하며, 상황을 함께 헤쳐나간다면 어떤 어려움도 극복할 수 있어요. 📖팀원들이 겪었던 실제 장애 사례들을 살펴볼까요? 안돼\n현장에서 실제로 발생했던 장애 사례를 통해, 우리는 중요한 교훈을 얻을 수 있어요.\n이런 사례들을 통해 앞으로 비슷한 상황을 방지하기 위한 대책을 세울 수도 있죠. 몇 가지 사례를 들어볼게요:\n데이터베이스 마이그레이션 사고\n한 회사에서 데이터베이스를 새로운 시스템으로 옮기는 작업 중에, 엄청난 준비에도 불구하고 휴먼에러로 큰 장애가 발생했어요. 알림 시스템 실패\n배송 알림을 보내는 시스템에서, 개발 환경에서는 발견되지 않았던 문제 때문에 운영 환경에서 큰 혼란이 생겼어요. 의도치 않은 직배송 문제\n주문 시스템에서 작은 코드 오류로 인해 모든 주문이 직배송으로 처리되는 큰 문제가 발생했어요. 결제 시스템 오류\n결제 시스템에 문제가 생겨 결제 실패율이 급증했고, 이는 매출 손실과 고객 신뢰도 저하로 이어졌어요. 이런 사례들을 통해, 우리는 장애 발생 시 신속하게 대응하고, 문제의 근본 원인을 파악하며, 비슷한 상황을 미리 방지하기 위한 대책을 마련할 수 있어요.\n그리고 무엇보다, 팀으로서 함께 문제를 해결해 나가는 과정에서 서로를 더 잘 이해하고 협력할 수 있는 기회가 될 수 있어요.\n하지만 가장 중요한 것은 문제를 빨리 알아챌 수 있냐는 것이죠!\n3. 📊 팀원들의 회사에서는 실제로 어떻게 모니터링하죠? 장애 모니터링은 문제를 바로 찾아내고, 왜 그런 일이 벌어졌는지 알아내고,\n빨리 해결할 수 있는 방법을 찾는 중요한 단계예요. 실제로 여러 방법을 써요.\n인프라와 서비스 모니터링 도구\nPrometheus, InfluxDB database에 저장한 시스템 상태를 실시간으로 지켜보고, 문제가 생기면 바로 알림을 받을 수 있어요. 응답 시간 체크\n서비스가 얼마나 빨리 응답하는지 계속 체크해서, 만약 느려지면 바로 알아챌 수 있어요. 이렇게 하면 사용자 경험에 나쁜 영향을 최소화할 수 있죠. 이벤트 로깅과 분석\nELK 스택 같은 로깅 시스템으로 일어나는 모든 일을 기록하고 분석해요. 이를 통해 문제의 원인을 파악하고, 어떻게 대처할지 방법을 찾을 수 있어요. 비즈니스 지표 모니터링\nDatadog, Grafana 같은 도구로 비즈니스 지표도 눈에 띄게 지켜봐요. 시스템은 멀쩡한데 갑자기 지표가 떨어지면, 뭔가 문제가 있을 수도 있으니까요. 이러한 동작들을 처리하는 시스템을 통합 모니터링 시스템이라고 불러요.\n이런 식으로 장애 모니터링 시스템을 잘 꾸려놓고 운영하면,\n문제가 생겼을 때 바로 대응할 수 있고, 시스템을 더 안정적으로 만들 수 있어요.\n우리가 이제 곧 설계해볼거예요!\n4. 💻 팀원들의 회사에서 쓰는 모니터링 시스템은 어떤 스펙을 가지고 있고, 개발자에게 어떻게 알림을 줄까요? 현업에서 쓰는 모니터링 시스템은 정말 다양한 기능과 스펙을 가지고 있어서,\n시스템 상태를 실시간으로 지켜보고, 문제가 생기면 개발자한테 바로 알려줄 수 있어요.\n각 회사에서 쓰는 시스템은 작은 차이가 있었지만 큰 틀에서는 아래와 같은 특징을 지니고 있었어요.\n높은 가용성과 확장성 어떤 상황에서든 모니터링이 멈추지 않도록 하고, 서비스가 커질 때 쉽게 늘릴 수 있어야 해요. 다양한 데이터 소스 로그, 메트릭, 트레이스 등 여러 데이터 소스에서 정보를 모을 수 있어야 하고, Prometheus나 InfluxDB, ELK 스택 같은 다양한 도구와 잘 맞물려 돌아가야 해요. 실시간 데이터 처리 모아진 데이터는 바로바로 처리되어야 하고, 이를 통해 문제를 즉시 알아차리고 대응할 수 있어야 해요. 알림 설정 유연성 문제의 심각도나 어디서 생겼는지, 누가 담당하는지에 따라 알림 우선순위나 받는 사람을 다르게 설정할 수 있어야 해요. 📢 알림 방식은 어떻게 되나요? 모니터링 시스템은 여러 방식으로 개발자에게 알림을 줘요:\n이메일과 SMS: 가장 기본적인 방법으로, 문제가 생기면 바로 이메일이나 SMS를 보내요. 모바일 앱 푸시 알림: 특정 모니터링 앱을 통해 실시간으로 푸시 알림을 받을 수 있어요. 채팅 툴 연동: Slack이나 Microsoft Teams 같은 채팅 툴과 연동해서, 문제가 생기면 바로 채팅방에 알림을 보내요. 자동화된 전화 호출: 문제가 크면 Opsgenie 같은 서비스를 통해 담당자에게 자동으로 전화를 걸어서 알려주기도 해요. 이렇게 알림 시스템을 잘 갖춰놓으면, 개발자가 문제를 바로 알아차리고 필요한 조치를 취할 수 있게 돼요. 게다가, 장애 대응 프로세스를 더 빠르고 효율적으로 만들 수 있죠 🏃‍♂️💨.\n5. 만들어 볼까요? 위에서 이해한 내용을 바탕으로 설계를 진행해 볼거예요.\n도메인 일반적으로 필요한 컴포넌트(도메인)을 예상해볼까요? 데이터 수집 : 지표 데이터를 수집 데이터 전송 : 지표 데이터를 모니터링 시스템으로 전송 데이터 저장소 : 전송되어 오는 데이터를 정리하고 저장 경보 : 데이터를 분석하고 이상 징후를 감지하고 경보를 발생 시킴 다양한 채널로 경보를 발송할 수 있어야 하겠죠? 시각화 : 데이터를 차트나 그래프 등으로 제공 데이터 모델 지표는 통상 시계열 데이터 형태로 기록해요\n예시 1 : cpu load에 대한 데이터와 레이블\nmetric_name cpu.load labels host:i631, env:prod timestamp 161423121 value 0.29 예시 2 : 지난 10분의 cpu load 평균값을 얻기 위해서는 어떻게 해야 할까요? CPU.load host=webserver01,region=us-west 1613707265 50 CPU.load host=webserver01,region=us-west 1613707265 62 CPU.load host=webserver02,region=us-west 1613707265 43 CPU.load host=webserver02,region=us-west 1613707265 53 ... CPU.load host=webserver01,region=us-west 1613707265 76 CPU.load host=webserver01,region=us-west 1613707265 83 각 행의 마지막에 기록된 cpu 부하 수치의 평균을 구하면 되겠네요! 50+62+43+…83 / n 이름 자료형 지표 이름 문자열 태그/레이블 집합 \u003c키:값\u003e 쌍의 리스트 지표 값 및 그 타임스탬프의 배열 \u003c값, 타임스탬프\u003e 쌍의 배열\u003e 데이터 접근 패턴에 대해 알아보기 쓰기 부하: 시간이 지날수록 쓰기 작업이 꾸준히 많아져요. 우리 시스템은 시시각각 변하는 데이터를 다루기 때문에, 쓰기 작업이 정말 많이 발생한답니다. 읽기 패턴: 읽기 작업은 좀 특이해요. 갑자기 많아졌다가, 어느 순간 아예 요청이 없을 수도 있어요. 마치 봄비처럼 갑자기 쏟아지다 그치는 것 같죠? 데이터 저장소 시스템 고민 데이터 저장소를 어떻게 구축할지 고민이 많으시죠? 일반적인 데이터베이스를 쓰는 것보다는, 우리 데이터의 특성에 맞는 솔루션을 찾는 게 좋아요. 특히 시계열 데이터를 다루는 우리 시스템에는 InfluxDB나 Prometheus 같은 전문 도구가 훨씬 잘 맞아요. 이미 시장에 좋은 도구들이 많으니, 굳이 처음부터 새로 만들려고 하지 않아도 돼요. 도메인 바탕의 설계안 지금까지 얘기한걸 바탕으로 대략적인 설계를 진행해볼께요. 우리 시스템의 주요 도메인을 소개할게요 Metrics Source: 여기서 우리의 모든 지표들이 시작되죠. Metrics Collector: 이 친구들은 지표들을 모아서 시계열의 기록으로 변환해주는 역할을 해요. Time-Series Database: 여기는 모든 지표들이 시간의 흐름에 따라 안전하게 보관되는 곳이에요. Query Service: 궁금한 게 있을 때 이 친구에게 물어보면 돼요. 좋은 DB가 있다면, 이 친구가 할 일이 훨씬 적어져요. Alerting System: 중요한 일이 생기면 바로 알려줘야 하죠. 다양한 방법으로 경보를 전달해줘요. Visualization System: 숫자와 데이터로 가득 찬 세상을 알아보기 쉽고 이해하기 쉬운 그래프와 차트로 변환해줘요. 상세 설계로 가볼까요? 지표 수집 지표 수집에는 크게 두 가지 방식이 있어요: Pull / Push Pull 모델에서는 수집기가 모든 지표를 직접 가져와요. 변화가 많은 환경에서는 조금 까다로울 수 있지만, etcd나 zookeeper 같은 도구로 해결할 수 있어요. 하지만 주의해야 할 점은, 지표 수집기가 여러 개일 때 중복된 지표를 가져올 수도 있다는 거예요. 이를 해결하기 위해 각 서버를 분배하는 방법을 써요. Push 모델에서는 지표를 만드는 곳에서 직접 보내줘요. 일반적으로는 모듈에 작은 에이전트를 설치해서 지표를 전송하죠. 이 방법의 좋은 점은 데이터를 사전에 처리할 수 있다는 거예요. 각 방식은 장단점이 있어서, 우리 시스템에 더 잘 맞는 방식을 골라야 해요.\n아래 표에서 각 방식의 특징을 비교해 봤어요!\n항목 Pull Push 설명 디버깅 ✅ 엔드포인트에 바로 접근 가능해요 상태 진단 ✅ 장애 지점을 쉽게 파악할 수 있어요 프로세스 종료 ✅ 지표를 전송하기 전에 프로세스가 종료될 위험이 적어요 네트워크 구성 ✅ 인프라 구성이 상대적으로 덜 복잡해요 성능 ✅ push가 사용하는 UDP가 전송 지연이 더 낮기 때문에 성능이 좋아요 지표 전송 파이프라인 확장하기 지표 수집은 많은 양을 감당해야 하니 서버 클러스터로 구성하는 건 어떨까요? 만약 데이터베이스에 문제가 생겨 전송에 실패하면 데이터가 날아갈 수도 있으니, 안전하게 큐를 하나 세워두는 게 좋겠어요. 이렇게 하면 수집 과정과 처리 과정 사이를 더 탄탄하게 연결할 수 있어요. 데이터 집계 어디서 할까? 수집 에이전트에서 하기: 여기서는 간단한 합산 같은 건 할 수 있지만, 복잡한 집계는 힘들어요. 가지고 있는 데이터만 볼 수 있으니까요. 데이터 수집 파이프라인에서 하기: 이 방법은 데이터 양을 줄일 수 있는 장점이 있지만, 원본 데이터를 잃어버릴 수 있고, 데이터가 늦게 도착했을 때 집계하는 데 문제가 생길 수 있어요. 질의할 때 하기: 가장 유연한 방법이지만, 질의 속도가 느려질 수 있어요. 지표가 요구하는 정확성과 데이터의 크기에 따라 적절한 지점에서 질의해야 해요! 질의 서비스는 어떻게 만들까? 시각화 도구나 경보 시스템과 데이터베이스 사이에서 매끄럽게 데이터를 전달해줄 질의 서비스가 있으면 좋겠어요. 캐시 계층을 추가하면 데이터베이스의 부하를 줄이고 더 빠른 서비스를 제공할 수 있어요. 저장소 계층 디자인 데이터 인코딩과 압축: 데이터의 첫 값을 저장하고 이후 값들은 변화량만 저장하면 얼마나 많은 공간을 아낄 수 있는지 상상해 보세요! Downsampling: 시간이 지남에 따라 해상도를 낮춰서 데이터를 더 효율적으로 저장해요. 예를 들어, 최근 7일은 초 단위로, 그 다음 30일은 분 단위로, 그리고 1년 동안은 시간 단위로요. Cold Storage: 오래된 데이터는 비용이 적게 드는 저장 공간으로 옮겨 보관해요. AWS의 Glacier 같은 서비스를 사용하면 돼요. 경보 시스템 구성하기 우선, 정책 파일을 캐싱해두고 경보 관리자가 이를 확인한 후 정책에 맞게 질의를 날려요. 경보는 중복 없이, 필요한 곳에만 정확히 전달되어야 해요.\n경보 메시지는 키-값 저장소에 안전하게 보관되며, 이후에 카프카 같은 메시지 큐를 통해 필요한 곳으로 전달돼요.\n시각화 시스템 만들기 데이터를 아름답게 보여줄 시각화 시스템이 필요해요. 그라파나 같은 멋진 도구가 이미 많으니, 굳이 처음부터 만들 필요는 없어요. 데이터와 사용자 사이에서 멋진 다리 역할을 해줄 거예요. 완성 자 그럼 이제 위에서 고민한 것을 모두 더해서 완성된 아키텍처를 구성할 거예요. 어때요? 이제 모니터링 시스템을 갖게 됐어요! 6. 정리.. 현업에서 많이 사용하는 모니터링 및 알람 시스템에 대해서 설계를 해봤어요.\n위에서 논의했던 내용들이 잘 반영된 설계가 나온것 같아요.\n이렇게 체계적이지 않더라도 IT 서비스 회사는 모두 모니터링 시스템을 갖추고 있답니다.\n혹시 면접에서 모니터링 또는 경보 시스템에 대한 설계 질문이 나오더라도 당황하지 않을 수 있겠죠? 😊\n","wordCount":"1612","inLanguage":"en","image":"https://team-json-delivery.github.io/images/metric-service/cover.png","datePublished":"2024-03-09T09:00:00+09:00","dateModified":"2024-03-09T09:00:00+09:00","author":{"@type":"Person","name":"zoster0828"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://team-json-delivery.github.io/posts/metric-service/"},"publisher":{"@type":"Organization","name":"Team JSON Delivery","logo":{"@type":"ImageObject","url":"https://team-json-delivery.github.io/%3Clink%20/%20abs%20url%3E"}}}</script><script>function changeGiscusTheme(){const e=document.body.classList.contains("dark")?"dark":"light";function t(e){const t=document.querySelector("iframe.giscus-frame");if(!t)return;t.contentWindow.postMessage({giscus:e},"https://giscus.app")}t({setConfig:{theme:e}})}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?(document.body.classList.add("dark"),setTimeout(changeGiscusTheme,2e3)):localStorage.getItem("pref-theme")==="light"?(document.body.classList.remove("dark"),setTimeout(changeGiscusTheme,2e3)):window.matchMedia("(prefers-color-scheme: dark)").matches&&(document.body.classList.add("dark"),setTimeout(changeGiscusTheme,2e3))</script><header class=header><nav class=nav><div class=logo><a href=https://team-json-delivery.github.io/ accesskey=h title="Team JSON Delivery (Alt + H)"><img src=https://team-json-delivery.github.io/apple-touch-icon.png alt aria-label=logo height=35>Team JSON Delivery</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://team-json-delivery.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://team-json-delivery.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://team-json-delivery.github.io/author/ title=author><span>author</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://team-json-delivery.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://team-json-delivery.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent" style=word-break:keep-all>모니터링, 알람 그리고 장애들 😊</h1><div class=post-meta><span title='2024-03-09 09:00:00 +0900 +0900'>2024년 03월 09일</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;1612 words&nbsp;·&nbsp;zoster0828&nbsp;|&nbsp;<a href=https://github.com/%3cpath_to_repo%3e/content/posts/metric-service.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><div id=figmask style=z-index:-1><img loading=eager src=https://team-json-delivery.github.io/images/metric-service/cover.png alt></div></figure><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#1--장애가-뭔가요>1. 🤔 장애가 뭔가요?</a></li><li><a href=#2--각-회사들은-장애를-어떻게-다루나요>2. 🏢 각 회사들은 장애를 어떻게 다루나요?</a><ul><li><a href=#장애에-대한-다양한-반응과-대처법>장애에 대한 다양한 반응과 대처법</a></li><li><a href=#팀원들이-겪었던-실제-장애-사례들을-살펴볼까요>📖팀원들이 겪었던 실제 장애 사례들을 살펴볼까요?</a></li></ul></li><li><a href=#3--팀원들의-회사에서는-실제로-어떻게-모니터링하죠>3. 📊 팀원들의 회사에서는 실제로 어떻게 모니터링하죠?</a></li><li><a href=#4--팀원들의-회사에서-쓰는-모니터링-시스템은-어떤-스펙을-가지고-있고-개발자에게-어떻게-알림을-줄까요>4. 💻 팀원들의 회사에서 쓰는 모니터링 시스템은 어떤 스펙을 가지고 있고, 개발자에게 어떻게 알림을 줄까요?</a><ul><li><a href=#-알림-방식은-어떻게-되나요>📢 알림 방식은 어떻게 되나요?</a></li></ul></li><li><a href=#5-만들어-볼까요>5. 만들어 볼까요?</a><ul><li><a href=#도메인>도메인</a></li><li><a href=#데이터-모델>데이터 모델</a></li><li><a href=#데이터-접근-패턴에-대해-알아보기>데이터 접근 패턴에 대해 알아보기</a></li><li><a href=#도메인-바탕의-설계안>도메인 바탕의 설계안</a></li><li><a href=#상세-설계로-가볼까요>상세 설계로 가볼까요?</a></li><li><a href=#지표-전송-파이프라인-확장하기>지표 전송 파이프라인 확장하기</a></li><li><a href=#데이터-집계-어디서-할까>데이터 집계 어디서 할까?</a></li><li><a href=#질의-서비스는-어떻게-만들까>질의 서비스는 어떻게 만들까?</a></li><li><a href=#저장소-계층-디자인>저장소 계층 디자인</a></li><li><a href=#경보-시스템-구성하기>경보 시스템 구성하기</a></li><li><a href=#시각화-시스템-만들기>시각화 시스템 만들기</a></li><li><a href=#완성>완성</a></li><li><a href=#6-정리>6. 정리..</a></li></ul></li></ul></nav></div></details></div><div class=post-content><blockquote><p>Team json delivery는 각자 다른 회사를 다니는 팀원들로 구성되어 있어요.</p><p>게임, IT, 금융, 제조업 까지 없는곳이 없어요!</p><p>어쩌면 도메인 별로 차이가 있을까요?</p><p>모여서 각 회사에서는 어떻게 모니터링을 하고 장애를 관리하는지에 대해</p><p>이야기를 나누고 설계를 진행해 보았어요.</p></blockquote><h2 id=1--장애가-뭔가요>1. 🤔 장애가 뭔가요?<a hidden class=anchor aria-hidden=true href=#1--장애가-뭔가요>#</a></h2><p><img loading=lazy src=/images/metric-service/dont3.png alt=img.png></p><blockquote><p>장애란, 우리가 쓰는 시스템이나 서비스가 제대로 작동하지 않는 상태를 말해요.</p><p>이런 문제는 네트워크가 느리거나 서버에 문제가 생기거나</p><p>데이터베이스가 이상한 등 다양한 이유로 생길 수 있어요.</p><p>DEVOPS와 microservice로 인한 모듈 파편화에 따라 이러한 모니터링, 또는 관측성이 더욱 중시되고 있어요!</p></blockquote><h2 id=2--각-회사들은-장애를-어떻게-다루나요>2. 🏢 각 회사들은 장애를 어떻게 다루나요?<a hidden class=anchor aria-hidden=true href=#2--각-회사들은-장애를-어떻게-다루나요>#</a></h2><blockquote><p>각 회사마다 장애에 대처하는 자신만의 방식이 있어요.</p><p>어떤 곳은 문제가 터지면 바로 알려줄 수 있는 시스템을 갖추고,</p><p>빨리 해결할 수 있도록 준비하는 곳도 있고요.</p><p>또, 장애에 어떻게 대응할지 프로세스를 확실하게 해두고,</p><p>모든 사람이 뭘 해야 할지 바로 알 수 있게 교육시키는 곳도 있어요 📚.</p><p>어느것이 더 낫다고 할수는 없지만 시스템 규모나 중요도에 따라 적절하게 구성해야 하겠죠.</p></blockquote><h3 id=장애에-대한-다양한-반응과-대처법>장애에 대한 다양한 반응과 대처법<a hidden class=anchor aria-hidden=true href=#장애에-대한-다양한-반응과-대처법>#</a></h3><ul><li>장애에 대한 반응은 사람마다 천차만별이에요. 일부는 담담하게 대응하는 반면, 다른 이들은 긴장하고 불안해할 수도 있어요. 중요한 건, 이런 상황에서 서로를 지지하고 격려하는 것이죠.</li><li>긴장하는 이들에게는 특히나 조심스러운 접근이 필요해요. 패닉 상태에 빠지지 않도록 옆에서 함께 문제를 풀어나가며, 마음을 진정시켜주는 게 중요해요.</li><li>금융권처럼 높은 스트레스를 받는 환경에서는, 배포 때마다 긴장감이 고조되곤 해요. 여기서는 더욱더 철저한 사전 준비와 서로를 위한 지지가 필요하겠죠.</li><li>전사적인 장애 상황이 발생하면, 더 큰 문제로 이어질 수 있어요. 이런 경우에는 전체 팀이 함께 힘을 모아 대응해야 해요. 서비스 회사뿐만 아니라 다른 분야에서도 마찬가지예요.</li><li>장애는 언제든 발생할 수 있어요. 하지만 서로를 믿고, 잘 대비하며, 상황을 함께 헤쳐나간다면 어떤 어려움도 극복할 수 있어요.</li></ul><h3 id=팀원들이-겪었던-실제-장애-사례들을-살펴볼까요>📖팀원들이 겪었던 실제 장애 사례들을 살펴볼까요?<a hidden class=anchor aria-hidden=true href=#팀원들이-겪었던-실제-장애-사례들을-살펴볼까요>#</a></h3><p><img loading=lazy src=/images/metric-service/fault.png alt=img.png></p><p><del>안돼</del></p><blockquote><p>현장에서 실제로 발생했던 장애 사례를 통해, 우리는 중요한 교훈을 얻을 수 있어요.</p><p>이런 사례들을 통해 앞으로 비슷한 상황을 방지하기 위한 대책을 세울 수도 있죠. 몇 가지 사례를 들어볼게요:</p></blockquote><ul><li><p>데이터베이스 마이그레이션 사고</p><ul><li>한 회사에서 데이터베이스를 새로운 시스템으로 옮기는 작업 중에, 엄청난 준비에도 불구하고 휴먼에러로 큰 장애가 발생했어요.</li></ul></li><li><p>알림 시스템 실패</p><ul><li>배송 알림을 보내는 시스템에서, 개발 환경에서는 발견되지 않았던 문제 때문에 운영 환경에서 큰 혼란이 생겼어요.</li></ul></li><li><p>의도치 않은 직배송 문제</p><ul><li>주문 시스템에서 작은 코드 오류로 인해 모든 주문이 직배송으로 처리되는 큰 문제가 발생했어요.</li></ul></li><li><p>결제 시스템 오류</p><ul><li>결제 시스템에 문제가 생겨 결제 실패율이 급증했고, 이는 매출 손실과 고객 신뢰도 저하로 이어졌어요.</li></ul></li></ul><blockquote><p>이런 사례들을 통해, 우리는 장애 발생 시 신속하게 대응하고, 문제의 근본 원인을 파악하며, 비슷한 상황을 미리 방지하기 위한 대책을 마련할 수 있어요.</p><p>그리고 무엇보다, 팀으로서 함께 문제를 해결해 나가는 과정에서 서로를 더 잘 이해하고 협력할 수 있는 기회가 될 수 있어요.</p><p>하지만 가장 중요한 것은 문제를 빨리 알아챌 수 있냐는 것이죠!</p></blockquote><h2 id=3--팀원들의-회사에서는-실제로-어떻게-모니터링하죠>3. 📊 팀원들의 회사에서는 실제로 어떻게 모니터링하죠?<a hidden class=anchor aria-hidden=true href=#3--팀원들의-회사에서는-실제로-어떻게-모니터링하죠>#</a></h2><p><img loading=lazy src=/images/metric-service/monitoring.png alt=img.png></p><blockquote><p>장애 모니터링은 문제를 바로 찾아내고, 왜 그런 일이 벌어졌는지 알아내고,</p><p>빨리 해결할 수 있는 방법을 찾는 중요한 단계예요. 실제로 여러 방법을 써요.</p></blockquote><ul><li><p>인프라와 서비스 모니터링 도구</p><ul><li>Prometheus, InfluxDB database에 저장한 시스템 상태를 실시간으로 지켜보고,
문제가 생기면 바로 알림을 받을 수 있어요.</li></ul></li><li><p>응답 시간 체크</p><ul><li>서비스가 얼마나 빨리 응답하는지 계속 체크해서, 만약 느려지면 바로 알아챌 수 있어요.
이렇게 하면 사용자 경험에 나쁜 영향을 최소화할 수 있죠.</li></ul></li><li><p>이벤트 로깅과 분석</p><ul><li>ELK 스택 같은 로깅 시스템으로 일어나는 모든 일을 기록하고 분석해요.
이를 통해 문제의 원인을 파악하고, 어떻게 대처할지 방법을 찾을 수 있어요.</li></ul></li><li><p>비즈니스 지표 모니터링</p><ul><li>Datadog, Grafana 같은 도구로 비즈니스 지표도 눈에 띄게 지켜봐요.
시스템은 멀쩡한데 갑자기 지표가 떨어지면, 뭔가 문제가 있을 수도 있으니까요.</li></ul></li></ul><blockquote><p>이러한 동작들을 처리하는 시스템을 통합 모니터링 시스템이라고 불러요.</p><p>이런 식으로 장애 모니터링 시스템을 잘 꾸려놓고 운영하면,</p><p>문제가 생겼을 때 바로 대응할 수 있고, 시스템을 더 안정적으로 만들 수 있어요.</p><p>우리가 이제 곧 설계해볼거예요!</p></blockquote><h2 id=4--팀원들의-회사에서-쓰는-모니터링-시스템은-어떤-스펙을-가지고-있고-개발자에게-어떻게-알림을-줄까요>4. 💻 팀원들의 회사에서 쓰는 모니터링 시스템은 어떤 스펙을 가지고 있고, 개발자에게 어떻게 알림을 줄까요?<a hidden class=anchor aria-hidden=true href=#4--팀원들의-회사에서-쓰는-모니터링-시스템은-어떤-스펙을-가지고-있고-개발자에게-어떻게-알림을-줄까요>#</a></h2><blockquote><p>현업에서 쓰는 모니터링 시스템은 정말 다양한 기능과 스펙을 가지고 있어서,</p><p>시스템 상태를 실시간으로 지켜보고, 문제가 생기면 개발자한테 바로 알려줄 수 있어요.</p><p>각 회사에서 쓰는 시스템은 작은 차이가 있었지만 큰 틀에서는 아래와 같은 특징을 지니고 있었어요.</p></blockquote><ul><li>높은 가용성과 확장성<ul><li>어떤 상황에서든 모니터링이 멈추지 않도록 하고,
서비스가 커질 때 쉽게 늘릴 수 있어야 해요.</li></ul></li><li>다양한 데이터 소스<ul><li>로그, 메트릭, 트레이스 등 여러 데이터 소스에서 정보를 모을 수 있어야 하고,
Prometheus나 InfluxDB, ELK 스택 같은 다양한 도구와 잘 맞물려 돌아가야 해요.</li></ul></li><li>실시간 데이터 처리<ul><li>모아진 데이터는 바로바로 처리되어야 하고, 이를 통해 문제를 즉시 알아차리고 대응할 수 있어야 해요.</li></ul></li><li>알림 설정 유연성<ul><li>문제의 심각도나 어디서 생겼는지, 누가 담당하는지에 따라 알림 우선순위나 받는 사람을 다르게 설정할 수 있어야 해요.</li></ul></li></ul><h3 id=-알림-방식은-어떻게-되나요>📢 알림 방식은 어떻게 되나요?<a hidden class=anchor aria-hidden=true href=#-알림-방식은-어떻게-되나요>#</a></h3><blockquote><p>모니터링 시스템은 여러 방식으로 개발자에게 알림을 줘요:</p></blockquote><ul><li>이메일과 SMS: 가장 기본적인 방법으로, 문제가 생기면 바로 이메일이나 SMS를 보내요.</li><li>모바일 앱 푸시 알림: 특정 모니터링 앱을 통해 실시간으로 푸시 알림을 받을 수 있어요.</li><li>채팅 툴 연동: Slack이나 Microsoft Teams 같은 채팅 툴과 연동해서, 문제가 생기면 바로 채팅방에 알림을 보내요.</li><li>자동화된 전화 호출: 문제가 크면 <a href=https://www.atlassian.com/ko/software/opsgenie>Opsgenie</a> 같은 서비스를 통해 담당자에게 자동으로 전화를 걸어서 알려주기도 해요.</li></ul><blockquote><p>이렇게 알림 시스템을 잘 갖춰놓으면, 개발자가 문제를 바로 알아차리고 필요한 조치를 취할 수 있게 돼요. 게다가, 장애 대응 프로세스를 더 빠르고 효율적으로 만들 수 있죠 🏃‍♂️💨.</p></blockquote><h2 id=5-만들어-볼까요>5. 만들어 볼까요?<a hidden class=anchor aria-hidden=true href=#5-만들어-볼까요>#</a></h2><blockquote><p>위에서 이해한 내용을 바탕으로 설계를 진행해 볼거예요.</p></blockquote><h3 id=도메인>도메인<a hidden class=anchor aria-hidden=true href=#도메인>#</a></h3><ul><li>일반적으로 필요한 컴포넌트(도메인)을 예상해볼까요?<ul><li>데이터 수집 : 지표 데이터를 수집</li><li>데이터 전송 : 지표 데이터를 모니터링 시스템으로 전송</li><li>데이터 저장소 : 전송되어 오는 데이터를 정리하고 저장</li><li>경보 : 데이터를 분석하고 이상 징후를 감지하고 경보를 발생 시킴<ul><li>다양한 채널로 경보를 발송할 수 있어야 하겠죠?</li></ul></li><li>시각화 : 데이터를 차트나 그래프 등으로 제공</li></ul></li></ul><h3 id=데이터-모델>데이터 모델<a hidden class=anchor aria-hidden=true href=#데이터-모델>#</a></h3><ul><li><p>지표는 통상 시계열 데이터 형태로 기록해요</p></li><li><p>예시 1 : cpu load에 대한 데이터와 레이블</p></li></ul><table><thead><tr><th style=text-align:center>metric_name</th><th style=text-align:center>cpu.load</th></tr></thead><tbody><tr><td style=text-align:center>labels</td><td style=text-align:center>host:i631, env:prod</td></tr><tr><td style=text-align:center>timestamp</td><td style=text-align:center>161423121</td></tr><tr><td style=text-align:center>value</td><td style=text-align:center>0.29</td></tr></tbody></table><ul><li>예시 2 : 지난 10분의 cpu load 평균값을 얻기 위해서는 어떻게 해야 할까요?</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>CPU.load <span class=nv>host</span><span class=o>=</span>webserver01,region<span class=o>=</span>us-west <span class=m>1613707265</span> <span class=m>50</span>
</span></span><span class=line><span class=cl>CPU.load <span class=nv>host</span><span class=o>=</span>webserver01,region<span class=o>=</span>us-west <span class=m>1613707265</span> <span class=m>62</span>
</span></span><span class=line><span class=cl>CPU.load <span class=nv>host</span><span class=o>=</span>webserver02,region<span class=o>=</span>us-west <span class=m>1613707265</span> <span class=m>43</span>
</span></span><span class=line><span class=cl>CPU.load <span class=nv>host</span><span class=o>=</span>webserver02,region<span class=o>=</span>us-west <span class=m>1613707265</span> <span class=m>53</span>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl>CPU.load <span class=nv>host</span><span class=o>=</span>webserver01,region<span class=o>=</span>us-west <span class=m>1613707265</span> <span class=m>76</span>
</span></span><span class=line><span class=cl>CPU.load <span class=nv>host</span><span class=o>=</span>webserver01,region<span class=o>=</span>us-west <span class=m>1613707265</span> <span class=m>83</span>
</span></span></code></pre></div><ul><li>각 행의 마지막에 기록된 cpu 부하 수치의 평균을 구하면 되겠네요!<ul><li>50+62+43+&mldr;83 / n</li></ul></li></ul><table><thead><tr><th style=text-align:center>이름</th><th style=text-align:center>자료형</th></tr></thead><tbody><tr><td style=text-align:center>지표 이름</td><td style=text-align:center>문자열</td></tr><tr><td style=text-align:center>태그/레이블 집합</td><td style=text-align:center>&lt;키:값> 쌍의 리스트</td></tr><tr><td style=text-align:center>지표 값 및 그 타임스탬프의 배열</td><td style=text-align:center>&lt;값, 타임스탬프> 쌍의 배열></td></tr></tbody></table><h3 id=데이터-접근-패턴에-대해-알아보기>데이터 접근 패턴에 대해 알아보기<a hidden class=anchor aria-hidden=true href=#데이터-접근-패턴에-대해-알아보기>#</a></h3><ul><li>쓰기 부하: 시간이 지날수록 쓰기 작업이 꾸준히 많아져요. 우리 시스템은 시시각각 변하는 데이터를 다루기 때문에, 쓰기 작업이 정말 많이 발생한답니다.</li><li>읽기 패턴: 읽기 작업은 좀 특이해요. 갑자기 많아졌다가, 어느 순간 아예 요청이 없을 수도 있어요. 마치 봄비처럼 갑자기 쏟아지다 그치는 것 같죠?</li><li>데이터 저장소 시스템 고민<ul><li>데이터 저장소를 어떻게 구축할지 고민이 많으시죠? 일반적인 데이터베이스를 쓰는 것보다는, 우리 데이터의 특성에 맞는 솔루션을 찾는 게 좋아요.</li><li>특히 시계열 데이터를 다루는 우리 시스템에는 InfluxDB나 Prometheus 같은 전문 도구가 훨씬 잘 맞아요. 이미 시장에 좋은 도구들이 많으니, 굳이 처음부터 새로 만들려고 하지 않아도 돼요.</li></ul></li></ul><h3 id=도메인-바탕의-설계안>도메인 바탕의 설계안<a hidden class=anchor aria-hidden=true href=#도메인-바탕의-설계안>#</a></h3><ul><li>지금까지 얘기한걸 바탕으로 대략적인 설계를 진행해볼께요.</li><li><img loading=lazy src=/images/metric-service/rough_design.png alt=img.png></li><li>우리 시스템의 주요 도메인을 소개할게요<ul><li>Metrics Source: 여기서 우리의 모든 지표들이 시작되죠.</li><li>Metrics Collector: 이 친구들은 지표들을 모아서 시계열의 기록으로 변환해주는 역할을 해요.</li><li>Time-Series Database: 여기는 모든 지표들이 시간의 흐름에 따라 안전하게 보관되는 곳이에요.</li><li>Query Service: 궁금한 게 있을 때 이 친구에게 물어보면 돼요. 좋은 DB가 있다면, 이 친구가 할 일이 훨씬 적어져요.</li><li>Alerting System: 중요한 일이 생기면 바로 알려줘야 하죠. 다양한 방법으로 경보를 전달해줘요.</li><li>Visualization System: 숫자와 데이터로 가득 찬 세상을 알아보기 쉽고 이해하기 쉬운 그래프와 차트로 변환해줘요.</li></ul></li></ul><h3 id=상세-설계로-가볼까요>상세 설계로 가볼까요?<a hidden class=anchor aria-hidden=true href=#상세-설계로-가볼까요>#</a></h3><ul><li>지표 수집<ul><li>지표 수집에는 크게 두 가지 방식이 있어요: Pull / Push</li><li>Pull 모델에서는 수집기가 모든 지표를 직접 가져와요. 변화가 많은 환경에서는 조금 까다로울 수 있지만, etcd나 zookeeper 같은 도구로 해결할 수 있어요. 하지만 주의해야 할 점은, 지표 수집기가 여러 개일 때 중복된 지표를 가져올 수도 있다는 거예요. 이를 해결하기 위해 각 서버를 분배하는 방법을 써요.</li><li>Push 모델에서는 지표를 만드는 곳에서 직접 보내줘요. 일반적으로는 모듈에 작은 에이전트를 설치해서 지표를 전송하죠. 이 방법의 좋은 점은 데이터를 사전에 처리할 수 있다는 거예요.</li></ul></li></ul><blockquote><p>각 방식은 장단점이 있어서, 우리 시스템에 더 잘 맞는 방식을 골라야 해요.</p><p>아래 표에서 각 방식의 특징을 비교해 봤어요!</p></blockquote><table><thead><tr><th style=text-align:center>항목</th><th style=text-align:center>Pull</th><th style=text-align:center>Push</th><th style=text-align:center>설명</th></tr></thead><tbody><tr><td style=text-align:center>디버깅</td><td style=text-align:center>✅</td><td style=text-align:center></td><td style=text-align:center>엔드포인트에 바로 접근 가능해요</td></tr><tr><td style=text-align:center>상태 진단</td><td style=text-align:center>✅</td><td style=text-align:center></td><td style=text-align:center>장애 지점을 쉽게 파악할 수 있어요</td></tr><tr><td style=text-align:center>프로세스 종료</td><td style=text-align:center></td><td style=text-align:center>✅</td><td style=text-align:center>지표를 전송하기 전에 프로세스가 종료될 위험이 적어요</td></tr><tr><td style=text-align:center>네트워크 구성</td><td style=text-align:center></td><td style=text-align:center>✅</td><td style=text-align:center>인프라 구성이 상대적으로 덜 복잡해요</td></tr><tr><td style=text-align:center>성능</td><td style=text-align:center>✅</td><td style=text-align:center></td><td style=text-align:center>push가 사용하는 UDP가 전송 지연이 더 낮기 때문에 성능이 좋아요</td></tr></tbody></table><h3 id=지표-전송-파이프라인-확장하기>지표 전송 파이프라인 확장하기<a hidden class=anchor aria-hidden=true href=#지표-전송-파이프라인-확장하기>#</a></h3><ul><li><img loading=lazy src=/images/metric-service/pipeline.png alt=img.png></li><li>지표 수집은 많은 양을 감당해야 하니 서버 클러스터로 구성하는 건 어떨까요?</li><li>만약 데이터베이스에 문제가 생겨 전송에 실패하면 데이터가 날아갈 수도 있으니, 안전하게 큐를 하나 세워두는 게 좋겠어요.</li><li>이렇게 하면 수집 과정과 처리 과정 사이를 더 탄탄하게 연결할 수 있어요.</li></ul><h3 id=데이터-집계-어디서-할까>데이터 집계 어디서 할까?<a hidden class=anchor aria-hidden=true href=#데이터-집계-어디서-할까>#</a></h3><ul><li>수집 에이전트에서 하기: 여기서는 간단한 합산 같은 건 할 수 있지만, 복잡한 집계는 힘들어요. 가지고 있는 데이터만 볼 수 있으니까요.</li><li>데이터 수집 파이프라인에서 하기: 이 방법은 데이터 양을 줄일 수 있는 장점이 있지만, 원본 데이터를 잃어버릴 수 있고, 데이터가 늦게 도착했을 때 집계하는 데 문제가 생길 수 있어요.</li><li>질의할 때 하기: 가장 유연한 방법이지만, 질의 속도가 느려질 수 있어요.</li><li>지표가 요구하는 정확성과 데이터의 크기에 따라 적절한 지점에서 질의해야 해요!</li></ul><h3 id=질의-서비스는-어떻게-만들까>질의 서비스는 어떻게 만들까?<a hidden class=anchor aria-hidden=true href=#질의-서비스는-어떻게-만들까>#</a></h3><ul><li>시각화 도구나 경보 시스템과 데이터베이스 사이에서 매끄럽게 데이터를 전달해줄 질의 서비스가 있으면 좋겠어요.</li><li>캐시 계층을 추가하면 데이터베이스의 부하를 줄이고 더 빠른 서비스를 제공할 수 있어요.</li><li><img loading=lazy src=/images/metric-service/query.png alt=img.png></li></ul><h3 id=저장소-계층-디자인>저장소 계층 디자인<a hidden class=anchor aria-hidden=true href=#저장소-계층-디자인>#</a></h3><ul><li>데이터 인코딩과 압축: 데이터의 첫 값을 저장하고 이후 값들은 변화량만 저장하면 얼마나 많은 공간을 아낄 수 있는지 상상해 보세요!</li><li>Downsampling: 시간이 지남에 따라 해상도를 낮춰서 데이터를 더 효율적으로 저장해요. 예를 들어, 최근 7일은 초 단위로, 그 다음 30일은 분 단위로, 그리고 1년 동안은 시간 단위로요.</li><li>Cold Storage: 오래된 데이터는 비용이 적게 드는 저장 공간으로 옮겨 보관해요. AWS의 Glacier 같은 서비스를 사용하면 돼요.</li></ul><h3 id=경보-시스템-구성하기>경보 시스템 구성하기<a hidden class=anchor aria-hidden=true href=#경보-시스템-구성하기>#</a></h3><ol><li>우선, 정책 파일을 캐싱해두고</li><li>경보 관리자가 이를 확인한 후</li><li>정책에 맞게 질의를 날려요.</li></ol><ul><li><p>경보는 중복 없이, 필요한 곳에만 정확히 전달되어야 해요.</p></li><li><p>경보 메시지는 키-값 저장소에 안전하게 보관되며, 이후에 카프카 같은 메시지 큐를 통해 필요한 곳으로 전달돼요.</p></li><li><p><img loading=lazy src=/images/metric-service/alert.png alt=img.png></p></li></ul><h3 id=시각화-시스템-만들기>시각화 시스템 만들기<a hidden class=anchor aria-hidden=true href=#시각화-시스템-만들기>#</a></h3><ul><li>데이터를 아름답게 보여줄 시각화 시스템이 필요해요.</li><li>그라파나 같은 멋진 도구가 이미 많으니, 굳이 처음부터 만들 필요는 없어요.</li><li>데이터와 사용자 사이에서 멋진 다리 역할을 해줄 거예요.</li></ul><h3 id=완성>완성<a hidden class=anchor aria-hidden=true href=#완성>#</a></h3><ul><li>자 그럼 이제 위에서 고민한 것을 모두 더해서 완성된 아키텍처를 구성할 거예요.</li><li><img loading=lazy src=/images/metric-service/final.png alt=img.png></li><li>어때요? 이제 모니터링 시스템을 갖게 됐어요!</li></ul><h3 id=6-정리>6. 정리..<a hidden class=anchor aria-hidden=true href=#6-정리>#</a></h3><blockquote><p>현업에서 많이 사용하는 모니터링 및 알람 시스템에 대해서 설계를 해봤어요.</p><p>위에서 논의했던 내용들이 잘 반영된 설계가 나온것 같아요.</p><p>이렇게 체계적이지 않더라도 IT 서비스 회사는 모두 모니터링 시스템을 갖추고 있답니다.</p><p>혹시 면접에서 모니터링 또는 경보 시스템에 대한 설계 질문이 나오더라도 당황하지 않을 수 있겠죠? 😊</p></blockquote></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=next href=https://team-json-delivery.github.io/posts/nearby-service/><span class=title>Next »</span><br><span>내 근처에는 누가 살고 있을까? : 위치 기반 서비스 설계하기</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share 모니터링, 알람 그리고 장애들 😊 on x" href="https://x.com/intent/tweet/?text=%eb%aa%a8%eb%8b%88%ed%84%b0%eb%a7%81%2c%20%ec%95%8c%eb%9e%8c%20%ea%b7%b8%eb%a6%ac%ea%b3%a0%20%ec%9e%a5%ec%95%a0%eb%93%a4%20%f0%9f%98%8a&amp;url=https%3a%2f%2fteam-json-delivery.github.io%2fposts%2fmetric-service%2f&amp;hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 모니터링, 알람 그리고 장애들 😊 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fteam-json-delivery.github.io%2fposts%2fmetric-service%2f&amp;title=%eb%aa%a8%eb%8b%88%ed%84%b0%eb%a7%81%2c%20%ec%95%8c%eb%9e%8c%20%ea%b7%b8%eb%a6%ac%ea%b3%a0%20%ec%9e%a5%ec%95%a0%eb%93%a4%20%f0%9f%98%8a&amp;summary=%eb%aa%a8%eb%8b%88%ed%84%b0%eb%a7%81%2c%20%ec%95%8c%eb%9e%8c%20%ea%b7%b8%eb%a6%ac%ea%b3%a0%20%ec%9e%a5%ec%95%a0%eb%93%a4%20%f0%9f%98%8a&amp;source=https%3a%2f%2fteam-json-delivery.github.io%2fposts%2fmetric-service%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 모니터링, 알람 그리고 장애들 😊 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fteam-json-delivery.github.io%2fposts%2fmetric-service%2f&title=%eb%aa%a8%eb%8b%88%ed%84%b0%eb%a7%81%2c%20%ec%95%8c%eb%9e%8c%20%ea%b7%b8%eb%a6%ac%ea%b3%a0%20%ec%9e%a5%ec%95%a0%eb%93%a4%20%f0%9f%98%8a"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 모니터링, 알람 그리고 장애들 😊 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fteam-json-delivery.github.io%2fposts%2fmetric-service%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 모니터링, 알람 그리고 장애들 😊 on whatsapp" href="https://api.whatsapp.com/send?text=%eb%aa%a8%eb%8b%88%ed%84%b0%eb%a7%81%2c%20%ec%95%8c%eb%9e%8c%20%ea%b7%b8%eb%a6%ac%ea%b3%a0%20%ec%9e%a5%ec%95%a0%eb%93%a4%20%f0%9f%98%8a%20-%20https%3a%2f%2fteam-json-delivery.github.io%2fposts%2fmetric-service%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 모니터링, 알람 그리고 장애들 😊 on telegram" href="https://telegram.me/share/url?text=%eb%aa%a8%eb%8b%88%ed%84%b0%eb%a7%81%2c%20%ec%95%8c%eb%9e%8c%20%ea%b7%b8%eb%a6%ac%ea%b3%a0%20%ec%9e%a5%ec%95%a0%eb%93%a4%20%f0%9f%98%8a&amp;url=https%3a%2f%2fteam-json-delivery.github.io%2fposts%2fmetric-service%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share 모니터링, 알람 그리고 장애들 😊 on ycombinator" href="https://news.ycombinator.com/submitlink?t=%eb%aa%a8%eb%8b%88%ed%84%b0%eb%a7%81%2c%20%ec%95%8c%eb%9e%8c%20%ea%b7%b8%eb%a6%ac%ea%b3%a0%20%ec%9e%a5%ec%95%a0%eb%93%a4%20%f0%9f%98%8a&u=https%3a%2f%2fteam-json-delivery.github.io%2fposts%2fmetric-service%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><script src=https://giscus.app/client.js data-repo=team-json-delivery/team-json-delivery.github.io data-repo-id=R_kgDOLAMZNQ data-category=comment data-category-id=DIC_kwDOLAMZNc4CcJ4o data-mapping=pathname data-strict=0 data-reactions-enabled=1 data-emit-metadata=0 data-input-position=bottom data-theme=preferred_color_scheme data-lang=ko crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2024 <a href=https://team-json-delivery.github.io/>Team JSON Delivery</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light"),changeGiscusTheme()):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"),changeGiscusTheme())})</script></body></html>