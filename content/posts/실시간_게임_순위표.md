# 실시간 게임 순위표

이번 글에서는 `가상 면접 사례로 배우는 대규모 시스템 설계 기초 2 10장 실시간 게임 순위표`를 소개하려고 합니다.  
실시간 게임 순위표의 특징을 간단히 알아보고, 기본적인 요소를 설계해봅시다.  

---

## 1. 실시간 게임 순위표 이해 및 설계 범위 확정하기

실시간 게임 순위표는 꽤 간단한 시스템으로 보입니다.  
하지만, 복잡성을 더할 수 있는 여러 가지 문제가 있으므로 요구사항(특징)을 분명히 확인하는게 좋습니다.  

```
1. 사용자는 경기에서 승리하면 포인트를 얻습니다.  
2. 모든 플레이어가 순위표에 포함되어야 합니다.  
3. 매달 새로운 토너먼트가 시작할 때마다 새로운 순위표를 만듭니다.  
4. 상위 10명의 사용자와 특정 사용자의 순위를 순위표에 표시할 수 있어야 합니다.  
5. DAU 500만 명, MAU 2,500만 명으로 가정합니다.  
6. 플레이어는 하루 평균 10경기를 치룹니다.  
7. 두 플레이어의 점수가 같을 경우 순위는 동일합니다.
8. 순위표는 실시간이어야 합니다.  
```

ZDNET [배달앱 상반기 MAU, 1년새 470만 줄었다](https://zdnet.co.kr/view/?no=20230707171205) 기사에 의하면 2023년 6월 배달앱(배달의민족과 요기요, 쿠팡이츠)의 MAU가 2,900만이라고 합니다.  
따라서, 요구사항으로 제시된 DAU 500만 명과 MAU 2,500만 명이라는 수치에 주의하여 시스템을 설계할 필요가 있습니다.  

DAU 500만 명인 게임에서 플레이어가 24시간 동안 고르게 분포한다면, 초당 평균 50명의 플레이어가 게임에 참여한다는 계산이 나옵니다.  
`500만 DAU / 10^5초(86400) =~ 50`  
하지만 게임 서비스 특성상 트래픽은 균등하지 않고, 저녁 시간에 집중될 가능성이 높습니다.  
이를 고려하여 최대 부하를 5배라고 가정하면 `초당 250명의 플레이어`를 감당할 수 있어야 합니다.  

플레이어는 하루 평균 10경기를 치룬다고 가정하였으므로 점수 획득 이벤트는 `평균 500QPS (50 x 10)`, `최대 2,500QPS (50 x 10 x 5)`입니다.

---

## 2. 개략적 설계안 제시하기

![simple-architecture.png](/images/game-ranking/simple-architecture.png)

개략적인 설계안 입니다.  
플레이어(단말)은 게임 승리 시 게임 서비스를 호출합니다.  
게임 서비스는 플레이어의 점수를 계산하고, 랭킹 서비스를 호출합니다.  
랭킹 서비스는 플레이어의 점수를 갱신합니다.  

요구사항에 따라 메시지 큐를 도입하는 등 서비스 구성을 다르게 설계할 수 있습니다.  
게임 순위표 시스템에서 가장 중요한 것은 **반드시 서버에서 점수 계산을 수행**해야한다는 점입니다.  
클라이언트는 중간자 공격과 같은 보안상 문제로 점수 계산을 하기에 적합하지 않습니다.  

> 중간자 공격(man in the middle attack, MITM)  
> https://ko.wikipedia.org/wiki/%EC%A4%91%EA%B0%84%EC%9E%90_%EA%B3%B5%EA%B2%A9  


