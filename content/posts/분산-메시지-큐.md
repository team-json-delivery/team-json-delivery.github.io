---
title: 'ë¶„ì‚° ë©”ì‹œì§€ íë¥¼ ì„¤ê³„í•˜ë©´ ë„Œ ðŸ˜€ë‹ˆì–´'
date: 2024-02-27T09:00:00+09:00
author: "junho3"
cover:
  image: "/images/message-queue/cover.png"
---

# ë¶„ì‚° ë©”ì‹œì§€ í ì„¤ê³„í•´ë³´ê¸°

MSA(Microservice Architecture)ê°€ ì•„í‚¤í…ì²˜ ì„¤ê³„ì˜ íŠ¸ëžœë“œê°€ ë˜ë©´ì„œ ë©”ì‹œì§€ íëŠ” ì‹œìŠ¤í…œ êµ¬ì„±ì˜ ì¤‘ìš”í•œ ìš”ì†Œë¡œ ìžë¦¬ìž¡ì•˜ìŠµë‹ˆë‹¤.    
ì´ë²ˆ ê¸€ì—ì„œëŠ” `ê°€ìƒ ë©´ì ‘ ì‚¬ë¡€ë¡œ ë°°ìš°ëŠ” ëŒ€ê·œëª¨ ì‹œìŠ¤í…œ ì„¤ê³„ ê¸°ì´ˆ 2 4ìž¥ ë¶„ì‚° ë©”ì‹œì§€ í`ë¥¼ ì†Œê°œí•˜ë ¤ê³  í•©ë‹ˆë‹¤.  
(ë©”ì„¸ì§€ íë¥¼ êµ¬ì„±í•˜ëŠ” ìš”ì†Œê°€ ë°©ëŒ€í•œ ë§Œí¼ ì„¸ë¶€ ê°œë…ì— ëŒ€í•œ ìžì„¸í•œ ì„¤ëª…ì€ ë„˜ì–´ê°€ê² ìŠµë‹ˆë‹¤.)  

---

ë³¸ê²©ì ì¸ ì„¤ê³„ì— ì•žì„œ ë©”ì‹œì§€ íì˜ ê¸°ëŠ¥ì„ ìƒê°í•´ë´…ì‹œë‹¤.

```
1. í”„ë¡œë“€ì„œëŠ” ë©”ì‹œì§€ íì— ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ ìˆ˜ ìžˆì–´ì•¼ í•©ë‹ˆë‹¤.  
2. ì»¨ìŠˆë¨¸ëŠ” ë©”ì‹œì§€ íë¥¼ í†µí•´ ë©”ì‹œì§€ë¥¼ ìˆ˜ì‹ í•  ìˆ˜ ìžˆì–´ì•¼ í•©ë‹ˆë‹¤.  
3. í•˜ë‚˜ì˜ ë©”ì‹œì§€ë¥¼ ì„œë¡œ ë‹¤ë¥¸ ì»¨ìŠˆë¨¸ê°€ ìˆ˜ì‹ í•  ìˆ˜ ìžˆì–´ì•¼ í•©ë‹ˆë‹¤.  
4. ë©”ì‹œì§€ê°€ ìƒì‚°ëœ ìˆœì„œëŒ€ë¡œ ì†Œë¹„ë  ìˆ˜ ìžˆë„ë¡ ìˆœì„œë¥¼ ë³´ìž¥í•´ì•¼ í•©ë‹ˆë‹¤.  
5. ì˜¤ëž˜ëœ ì´ë ¥ ë°ì´í„°ëŠ” ì‚­ì œë  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.  
6. ë©”ì‹œì§€ í¬ê¸°ëŠ” í‚¬ë¡œë°”ì´íŠ¸ ìˆ˜ì¤€ìž…ë‹ˆë‹¤.  
7. ë©”ì‹œì§€ëŠ” ìµœì†Œ í•œ ë²ˆ, ìµœëŒ€ í•œ ë²ˆ, ì •í™•ížˆ í•œ ë²ˆ ê°€ìš´ë° ì„¤ì •í•  ìˆ˜ ìžˆì–´ì•¼ í•©ë‹ˆë‹¤.` 
```

ë©”ì‹œì§€ íì˜ ë¹„ê¸°ëŠ¥ ìš”êµ¬ì‚¬í•­ì€ 3ê°€ì§€ê°€ ìžˆìŠµë‹ˆë‹¤.

```
1. ë†’ì€ ëŒ€ì—­í­ê³¼ ë‚®ì€ ì „ì†¡ ì§€ì—° ì¤‘ í•˜ë‚˜ë¥¼ ì„¤ì •ìœ¼ë¡œ ì„ íƒ ê°€ëŠ¥í•´ì•¼ í•©ë‹ˆë‹¤.  
2. ë©”ì‹œì§€ ì–‘ì´ ê¸‰ì¦í•´ë„ ì²˜ë¦¬ ê°€ëŠ¥í•´ì•¼ í•©ë‹ˆë‹¤.  
3. ë°ì´í„°ëŠ” ë””ìŠ¤í¬ì— ë³´ê´€ë˜ì–´ì•¼ í•˜ë©° ì—¬ëŸ¬ ë…¸ë“œì— ë³µì œë˜ì–´ì•¼ í•©ë‹ˆë‹¤.  
```

> Kafkaì™€ RabbitMQì˜ ì°¨ì´ì ì€ ë¬´ì—‡ì¸ê°€ìš”?  
> https://aws.amazon.com/ko/compare/the-difference-between-rabbitmq-and-kafka/  
> 
> ì¹´í”„ì¹´ê°€ ë¬´ì—‡ì´ê³ , ì™œ ì‚¬ìš©í•˜ëŠ” ê²ƒ ì¼ê¹Œ?  
> https://hudi.blog/what-is-kafka/  

----

ë‹¤ìŒìœ¼ë¡œ í”„ë¡œë“€ì„œì—ì„œ ë°œí–‰í•œ ë©”ì‹œì§€ê°€ ì»¨ìŠˆë¨¸ê¹Œì§€ ì–´ë–»ê²Œ ì „ë‹¬ë˜ëŠ”ì§€ íë¦„ì„ ìƒê°í•´ë´…ì‹œë‹¤.  
ì±…ì—ì„œëŠ” `ì¼ëŒ€ì¼ ëª¨ë¸`ë¶€í„° ë‹¨ê³„ì ìœ¼ë¡œ ì†Œê°œí•˜ê³  ìžˆì§€ë§Œ, ì´ ê¸€ì—ì„œëŠ” `ë°œí–‰(Pub)-êµ¬ë…(Sub) ëª¨ë¸` ê¸°ë°˜ì˜ ìµœì¢… ëª¨ìŠµë§Œ ì†Œê°œí•˜ê² ìŠµë‹ˆë‹¤.  

![flow.png](/images/message-queue/flow.png)

```
1. ì£¼ë¬¸ ì„œë¹„ìŠ¤(í”„ë¡œë“€ì„œ)ê°€ ì£¼ë¬¸ì™„ë£Œ ì´ë²¤íŠ¸ ë©”ì‹œì§€ë¥¼ ë°œí–‰í•©ë‹ˆë‹¤.  
2. ë©”ì‹œì§€ê°€ ì£¼ë¬¸ì™„ë£Œ í† í”½ì— ë„ì°©í•©ë‹ˆë‹¤.  
3. í† í”½ì— ë„ì°©í•œ ë©”ì‹œì§€ëŠ” ë¼ìš´ë“œ ë¡œë¹ˆ ë“±ì˜ ë°©ì‹ìœ¼ë¡œ íŒŒí‹°ì…˜ì— ë¶„ë°°ë©ë‹ˆë‹¤.  
4. ì£¼ë¬¸ì™„ë£Œ í† í”½ì„ êµ¬ë…í•˜ê³  ìžˆëŠ” ë°°ì†¡ ì»¨ìŠˆë¨¸ì™€ ì£¼ë¬¸ì™„ë£Œ ì•Œë¦¼í†¡ ì»¨ìŠˆë¨¸ëŠ” ìˆ˜ì‹  ë°›ì€ ë©”ì‹œì§€ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.  
```

ìœ„ ì´ë¯¸ì§€ì™€ ê°™ì´ í”„ë¡œë“€ì„œê°€ í† í”½ì— ë©”ì‹œì§€ë¥¼ ë°œí–‰í•˜ê³ , ì»¨ìŠˆë¨¸ ê·¸ë£¹ì´ í† í”½(íŒŒí‹°ì…˜)ì˜ ë©”ì‹œì§€ë¥¼ êµ¬ë…í•œë‹¤ë©´ ìš”êµ¬ì‚¬í•­ 1~3ë²ˆì„ ë‹¬ì„±í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.  
í•œ ê°€ì§€ ì¤‘ìš”í•˜ê²Œ ìƒê°í•´ë³¼ ê²ƒì€ `ë¸Œë¡œì»¤ê°€ ë©”ì‹œì§€ë¥¼ ì»¨ìŠˆë¨¸ì—ê²Œ ë³´ë‚¼ ê²ƒ(í‘¸ì‹œ ëª¨ë¸)`ì¸ê°€ ì•„ë‹ˆë©´ `ì»¨ìŠˆë¨¸ê°€ ë¸Œë¡œì»¤ì—ì„œ ê°€ì ¸ê°ˆ ê²ƒ(í’€ ëª¨ë¸)` ì¸ì§€ìž…ë‹ˆë‹¤.  
`í‘¸ì‹œ ëª¨ë¸(RabbitMQ, ActiveMQ)`ê³¼ `í’€ ëª¨ë¸(Kafka)`ì€ ê°ê° ìž¥ë‹¨ì ì´ ìžˆì–´ ìš”êµ¬ì‚¬í•­ì— ì í•©í•œ ëª¨ë¸ ì„ íƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.  

> ë°œí–‰-êµ¬ë… ëª¨ë¸  
> https://ko.wikipedia.org/wiki/%EB%B0%9C%ED%96%89-%EA%B5%AC%EB%8F%85_%EB%AA%A8%EB%8D%B8  

----

ë©”ì‹œì§€ì˜ ìˆœì„œëŠ” ì–´ë–»ê²Œ ë³´ìž¥í•  ìˆ˜ ìžˆì„ê¹Œìš”?  

íŒŒí‹°ì…˜ì€ FIFO íì²˜ëŸ¼ ë™ìž‘í•˜ë¯€ë¡œ ê°™ì€ íŒŒí‹°ì…˜ ì•ˆì—ì„œëŠ” ë©”ì‹œì§€ ìˆœì„œë¥¼ ë³´ìž¥í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.  
í•˜ì§€ë§Œ í† í”½ ê´€ì ì—ì„œëŠ” ìˆœì„œë¥¼ ë³´ìž¥í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ë©”ì‹œì§€ì— í‚¤ë¥¼ í• ë‹¹í•´ì•¼ í•©ë‹ˆë‹¤.

![message-key.png](/images/message-queue/message-key.png)

ìœ„ ì´ë¯¸ì§€ì²˜ëŸ¼ ê°™ì€ í‚¤ë¥¼ ê°€ì§„ ë©”ì‹œì§€ë¥¼ ê°™ì€ íŒŒí‹°ì…˜ìœ¼ë¡œ ë³´ë‚¸ë‹¤ë©´ í‚¤ë¥¼ ê°€ì§„ ë©”ì‹œì§€ëŠ” ìˆœì„œë¥¼ ë³´ìž¥í•  ìˆ˜ ìžˆê²Œ ë©ë‹ˆë‹¤.  
ë¬¼ë¡ , ë©”ì‹œì§€ í‚¤ë¥¼ í• ë‹¹í•˜ì—¬ë„ í† í”½ ê´€ì ì—ì„œ ì™„ë²½í•œ ìˆœì„œ ë³´ìž¥ì€ ì–´ë µìŠµë‹ˆë‹¤.  
í•œ ìŠ¤í„°ë””ì›ì— ë”°ë¥´ë©´, ì»¨ìŠˆë¨¸ëŠ” ë©”ì‹œì§€ë¥¼ DBì— ì ìž¬í•˜ê³  ë³„ë„ ë°°ì¹˜ ë“±ìœ¼ë¡œ DBì— ì ìž¬ ëœ ë°ì´í„°ë¥¼ ê¸°ì¤€ ì‹œê°„ ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ì²˜ë¦¬í•œ ê²½í—˜ì„ ê³µìœ í•´ì£¼ì…¨ìŠµë‹ˆë‹¤.  

----

ë°ì´í„°ì˜ ìž¥ê¸° ë³´ê´€ ìš”êµ¬ì‚¬í•­ì„ ë§Œì¡±í•˜ë©´ì„œ ë†’ì€ ëŒ€ì—­í­ì„ ì œê³µí•˜ë ¤ë©´ ë°ì´í„° ì €ìž¥ì†Œì™€ ì ìž¬ ë°©ì‹ì„ ê³ ë¯¼í•´ì•¼ í•©ë‹ˆë‹¤.  

ë©”ì‹œì§€ íëŠ” ì½ê¸°ì™€ ì“°ê¸°ê°€ ëŒ€ê·œëª¨ë¡œ ë¹ˆë²ˆí•˜ê²Œ ì¼ì–´ë‚˜ê¸° ë•Œë¬¸ì— íŒŒì¼ì— ì €ìž¥í•˜ëŠ” ê²ƒì´ ì í•©í•©ë‹ˆë‹¤.  
ì±…ì—ì„œëŠ” `ì“°ê¸° ìš°ì„  ë¡œê·¸(Write-Ahead Log, WAL)`ì„ ì†Œê°œí•˜ê³  ìžˆëŠ”ë°, ìƒˆë¡œìš´ í•­ëª©ì´ ì¶”ê°€ë˜ê¸°ë§Œ í•˜ëŠ” ì¼ë°˜ì ì¸ íŒŒì¼ êµ¬ì¡°ìž…ë‹ˆë‹¤.  
ë˜í•œ, íŒŒì¼ì´ ë¬´í•œì • ì»¤ì§ˆ ê²ƒì„ ëŒ€ë¹„í•˜ì—¬ `ì„¸ê·¸ë¨¼íŠ¸ ë‹¨ìœ„`ë¡œ íŒŒì¼ì„ ë¶„í• í•´ì•¼ í•©ë‹ˆë‹¤.  

![storage.png](/images/message-queue/storage.png)

ìœ„ì™€ ê°™ì´ í† í”½ì˜ íŒŒí‹°ì…˜ í•˜ìœ„ì— ì„¸ê·¸ë¨¼íŠ¸ë³„ë¡œ WALì„ ê´€ë¦¬í•œë‹¤ë©´, ìš©ëŸ‰ í•œê³„ì— ë„ë‹¬í•˜ê±°ë‚˜ ë³´ê´€ ê¸°ê°„ì´ ë§Œë£Œëœ ì˜¤ëž˜ëœ ì„¸ê·¸ë¨¼íŠ¸ íŒŒì¼ì„ ì‚­ì œí•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.  

ì±…ì—ì„œëŠ” `íšŒì „ ë””ìŠ¤í¬ ì‚¬ìš©`ê³¼ `ë°°ì¹˜ ì²˜ë¦¬` ë“± I/Oë¥¼ ì¤„ì´ëŠ” ë°©ë²•ë„ ì†Œê°œí•˜ê³  ìžˆìŠµë‹ˆë‹¤.  

----

ë©”ì‹œì§€ íëŠ” ë‚´ë¶€ì ìœ¼ë¡œ ë‹¤ì–‘í•œ ë©”íƒ€ ì •ë³´ë¥¼ ê´€ë¦¬í•´ì•¼ í•©ë‹ˆë‹¤.  

```
- íŒŒí‹°ì…˜ì— í• ë‹¹ëœ ì»¨ìŠˆë¨¸ ì •ë³´  
- ì»¨ìŠˆë¨¸ê°€ ì½ì–´ê°„ ë§ˆì§€ë§‰ ë©”ì‹œì§€ì˜ ì˜¤í”„ì…‹  
- í† í”½ ì„¤ì •ì´ë‚˜ ì†ì„± ì •ë³´  
- ë©”ì‹œì§€ ë° ì‚¬ë³¸ ë“± ê¸°íƒ€ ì •ë³´  
```

ìœ„ì™€ ê°™ì€ ì •ë³´ë“¤ì€ ë†’ì€ ì¼ê´€ì„±ì„ ìš”êµ¬í•˜ë¯€ë¡œ `Apache ZooKeeper` ê°™ì€ í‚¤-ê°’ ì €ìž¥ì†Œë¥¼ ê³ ë ¤í•˜ëŠ” ê²ƒì´ ì í•©í•©ë‹ˆë‹¤.  
ë˜í•œ, ì£¼í‚¤í¼ëŠ” `ë¸Œë¡œì»¤ì˜ ë¦¬ë” ì„ ì¶œ` ê³¼ì •ì„ ë•ê¸°ë„ í•©ë‹ˆë‹¤.  

![zookeeper.png](/images/message-queue/zookeeper.png)

ì´ˆê¸° KafkaëŠ” Zookeeperê°€ ìžì£¼ ì£½ì–´ì„œ ê³ ìƒí–ˆë‹¤ëŠ” ìŠ¤í„°ë””ì›ì˜ ê²½í—˜ë‹´ì„ ë“¤ì„ ìˆ˜ ìžˆì—ˆìŠµë‹ˆë‹¤.  
Kafka ë²„ì „ì´ ì—…ë°ì´íŠ¸ ë  ìˆ˜ë¡ Zookeeper ì•ˆì •ì„±ì€ ë†’ì•„ì¡Œì§€ë§Œ, Zookeeperë¡œ ì¸í•œ ë³µìž¡ë„ ì¦ê°€ ë•Œë¬¸ì— Kraft ì „í™˜ ìž‘ì—…ì„ ì§„í–‰í•˜ê³  ìžˆìŠµë‹ˆë‹¤.  
 
> KIP-833: Mark KRaft as Production Ready  
> https://cwiki.apache.org/confluence/display/KAFKA/KIP-833%3A+Mark+KRaft+as+Production+Ready  
> 
> Kafkaâ€™s Shift from ZooKeeper to Kraft  
> https://www.baeldung.com/kafka-shift-from-zookeeper-to-kraft  

----

ë¶„ì‚° ì‹œìŠ¤í…œì—ì„œ í•˜ë“œì›¨ì–´ ìž¥ì• ëŠ” ì–¸ì œë“ ì§€ ë°œìƒí•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.  
ë°ì´í„° ìœ ì‹¤ì„ ë§‰ê³  ê°€ìš©ì„±ì„ ë³´ìž¥í•˜ê¸° ìœ„í•´ `ë³µì œ(Replication)`ë¥¼ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤.  

![replication.png](/images/message-queue/replication.png)

ë¦¬ë” íŒŒí‹°ì…˜ê³¼ ì‚¬ë³¸ íŒŒí‹°ì…˜ì´ ìžˆìœ¼ë©° ë¦¬ë”ì™€ ì‚¬ë³¸ì€ ì„œë¡œ ë‹¤ë¥¸ ë¸Œë¡œì»¤ì— ì¡´ìž¬í•©ë‹ˆë‹¤.  
í”„ë¡œë“€ì„œëŠ” ë¦¬ë” íŒŒí‹°ì…˜ì—ê²Œë§Œ ë©”ì‹œì§€ë¥¼ ë°œí–‰í•©ë‹ˆë‹¤.  
ì‚¬ë³¸ íŒŒí‹°ì…˜ì€ ë¦¬ë” íŒŒí‹°ì…˜ì„ ë™ê¸°í™”í•©ë‹ˆë‹¤.   
ë¦¬ë” íŒŒí‹°ì…˜ì€ ì‚¬ë³¸ íŒŒí‹°ì…˜ì˜ ë™ê¸°í™”ë¥¼ ì²´í¬í•˜ê³  í”„ë¡œë“€ì„œì— `ë©”ì‹œì§€ ìˆ˜ì‹  ì‘ë‹µ(Ack)`ì„ í•©ë‹ˆë‹¤.  

Ack ì„¤ì •ì€ ë©”ì‹œì§€íì˜ ì„±ëŠ¥ê³¼ ì˜ì†ì„± ì‚¬ì´ì—ì„œ íƒ€í˜‘ì„ í•´ì•¼í•©ë‹ˆë‹¤.  
- `Ack=all`
  - ëª¨ë“  ì‚¬ë³¸ íŒŒí‹°ì…˜ì´ ë™ê¸°í™”ë¥¼ í•´ì•¼í•˜ë¯€ë¡œ ë©”ì‹œì§€ ìœ ì‹¤ ì—†ìŒ
  - ëŠë¦° ì‘ë‹µ
  - ì†¡ê¸ˆ, ì£¼ë¬¸ ë“± ë°ì´í„°ê°€ ìœ ì‹¤ë˜ë©´ ì•ˆë˜ëŠ” ê²½ìš°
- `Ack=1`
  - ë¦¬ë” íŒŒí‹°ì…˜ì´ ë©”ì‹œì§€ë¥¼ ì €ìž¥í•˜ê³  Ackë¥¼ í•˜ë¯€ë¡œ ë¦¬ë” íŒŒí‹°ì…˜ ìž¥ì•  ë°œìƒ ì‹œ ë©”ì‹œì§€ ìœ ì‹¤
  - í•«ë”œ ì•± í‘¸ì‹œ ë©”ì‹œì§€ ê°™ì´ ì¼ì • ë¶€ë¶„ ìœ ì‹¤ì„ ê°ìˆ˜í•˜ë”ë¼ë„, ëŒ€ëŸ‰ ì²˜ë¦¬ê°€ í•„ìš”í•œ ê²½ìš°
- `Ack=0`
  - Ackë¥¼ ê¸°ë‹¤ë¦¬ì§€ ì•Šìœ¼ë¯€ë¡œ ì–¸ì œë“ ì§€ ë©”ì‹œì§€ ìœ ì‹¤ ë°œìƒ ê°€ëŠ¥
  - ë¹ ë¥¸ ì‘ë‹µ
  - ë¡œê·¸, ì§€í‘œ ë“± ë°ì´í„°ê°€ ìœ ì‹¤ë˜ë„ ìƒê´€ ì—†ëŠ” ê²½ìš°

----

ë©”ì‹œì§€ íëŠ” ì‹œìŠ¤í…œ íŠ¹ì„±ìƒ ë¶„ì‚° ì‹œìŠ¤í…œì¼ ìˆ˜ë°–ì— ì—†ìŠµë‹ˆë‹¤.  
ë‹¨ê¸°ê°„ì— ë©”ì‹œì§€ê°€ ê¸‰ì¦í•´ë„ ì²˜ë¦¬ê°€ ê°€ëŠ¥í•´ì•¼ í•©ë‹ˆë‹¤.  
ì£¼ìš” ì»´í¬ë„ŒíŠ¸ ê´€ì ì—ì„œ ê·œëª¨ í™•ìž¥ì„±ì„ ì–´ë–»ê²Œ ë‹¬ì„±í•  ìˆ˜ ìžˆì„ì§€ ìƒê°í•´ë´…ì‹œë‹¤.  

#### í”„ë¡œë“€ì„œ
ë©”ì‹œì§€ë¥¼ ìƒì‚°í•˜ëŠ” í”„ë¡œë“€ì„œëŠ” ì‚¬ìš©ëŸ‰(íŠ¸ëž˜í”½)ì— ë”°ë¼ í”„ë¡œë“€ì„œë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ì‚­ì œí•¨ìœ¼ë¡œì¨ ê·œëª¨ í™•ìž¥ì„±ì„ ë‹¬ì„±í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.  

#### ì»¨ìŠˆë¨¸
ë©”ì‹œì§€ ì²˜ë¦¬ëŸ‰ë³´ë‹¤ ìƒì‚°ëŸ‰ì´ ë§Žë‹¤ë©´, ì»¨ìŠˆë¨¸ë¥¼ ì¶”ê°€í•˜ì—¬ ì²˜ë¦¬ëŸ‰ì„ ëŠ˜ë ¤ì•¼ í•©ë‹ˆë‹¤.  
ì»¨ìŠˆë¨¸ê°€ ì¶”ê°€/ì‚­ì œë˜ë©´ ë¦¬ë°¸ëŸ°ì‹±ì´ ë°œìƒí•˜ë©°, ë©”ì‹œì§€ í ì„¤ì •ì— ë”°ë¼ ì‚¬ì´ë“œ ì´íŽ™íŠ¸ê°€ ë°œìƒí•  ìˆ˜ ìžˆìœ¼ë¯€ë¡œ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.  

> ì¹´í”„ì¹´ ì»¨ìŠˆë¨¸ ê·¸ë£¹ ë¦¬ë°¸ëŸ°ì‹± (Kafka Consumer Group Rebalancing)  
> https://techblog.gccompany.co.kr/%EC%B9%B4%ED%94%84%EC%B9%B4-%EC%BB%A8%EC%8A%88%EB%A8%B8-%EA%B7%B8%EB%A3%B9-%EB%A6%AC%EB%B0%B8%EB%9F%B0%EC%8B%B1-kafka-consumer-group-rebalancing-5d3e3b916c9e

#### ë¸Œë¡œì»¤
ë¸Œë¡œì»¤ ë‚´ë¶€ì—ëŠ” í† í”½ì˜ ë¦¬ë” íŒŒí‹°ì…˜ê³¼ ì‚¬ë³¸ íŒŒí‹°ì…˜ì´ ì¡´ìž¬í•˜ë©°, ì‹¤ì œ ë°ì´í„°ê°€ ê¸°ë¡ëœ WALì„ ì €ìž¥í•˜ê³  ìžˆìŠµë‹ˆë‹¤.  
ë”°ë¼ì„œ ë¸Œë¡œì»¤ê°€ ì¶”ê°€/ì‚­ì œë  ê²½ìš° ë°ì´í„° ìœ ì‹¤ ì—†ì´ ì‚¬ë³¸ì„ ì–´ë–»ê²Œ ë¶„ì‚°í• ì§€ ê³„íšì„ ì„¸ì›Œì•¼ í•©ë‹ˆë‹¤.    

#### íŒŒí‹°ì…˜
íŒŒí‹°ì…˜ ë‹¹ í•œ ê°œì˜ ì»¨ìŠˆë¨¸ë§Œ í• ë‹¹ë  ìˆ˜ ìžˆìœ¼ë¯€ë¡œ, íŒŒí‹°ì…˜ê³¼ ì»¨ìŠˆë¨¸ë¥¼ ê°™ì€ ìˆ˜ë¡œ ì¦ê°€ì‹œì¼œì•¼ í•©ë‹ˆë‹¤.  
íŒŒí‹°ì…˜ ìˆ˜ ì¡°ì •ì€ ë¹„ìš©ì´ í° ìž‘ì—…ì´ë¯€ë¡œ íŠ¸ëž˜í”½ì´ ì—†ëŠ” ì‹œê°„ëŒ€ì— ìž‘ì—…í•˜ëŠ”ê²Œ ì¢‹ìŠµë‹ˆë‹¤.  
ë˜í•œ, ì¹´í”„ì¹´ ì„¤ì •ì— ë”°ë¼ ë©”ì‹œì§€ê°€ ìœ ì‹¤ë  ìˆ˜ ìžˆìœ¼ë¯€ë¡œ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.  

> ì¹´í”„ì¹´ ì»¨ìŠˆë¨¸ì˜ auto.offset.reset ì˜µì…˜ì„ ë°˜ë“œì‹œ earliestë¡œ ë³€ê²½í•´ì•¼ í•˜ëŠ” ì´ìœ   
> https://blog.voidmainvoid.net/514  
> 
> Kafkaì—ì„œ íŒŒí‹°ì…˜ ì¦ê°€ ì—†ì´ ë™ì‹œ ì²˜ë¦¬ëŸ‰ì„ ëŠ˜ë¦¬ëŠ” ë°©ë²• - Parallel Consumer  
> https://d2.naver.com/helloworld/7181840  
> 
> Support Reducing Partitions for Topics  
> https://cwiki.apache.org/confluence/display/KAFKA/KIP-694%3A+Support+Reducing+Partitions+for+Topics  

----

ë©”ì‹œì§€ íë¥¼ ì‚¬ìš©í•˜ë©´ í”„ë¡œë“€ì„œì™€ ì»¨ìŠˆë¨¸ëŠ” ëŠìŠ¨í•œ ê²°í•© êµ¬ì¡°ê°€ ë˜ë©´ì„œ ì„œë¡œ ë¹„ë™ê¸°ì ìœ¼ë¡œ ìˆ˜í–‰í•©ë‹ˆë‹¤.  
ë”°ë¼ì„œ ë©”ì‹œì§€ ì „ì†¡ì˜ ì‹ ë¢°ì„±ì„ ë³´ìž¥í•´ì•¼ í•˜ë©°, ë©”ì‹œì§€ íì˜ ì„±ëŠ¥(ì‹ ë¢°ì„±â†“)ê³¼ ë©”ì‹œì§€ ì „ì†¡ì˜ ì‹ ë¢°ì„±(ì„±ëŠ¥â†“) ì‚¬ì´ì—ì„œ ì„ íƒí•  ìˆ˜ ìžˆë„ë¡ ë©”ì‹œì§€ ì „ë‹¬ ë°©ì‹ì„ ì§€ì›í•´ì•¼ í•©ë‹ˆë‹¤.  
ì¼ë°˜ì ìœ¼ë¡œ ë©”ì‹œì§€ íëŠ” ì„¸ ê°€ì§€ ë©”ì‹œì§€ ì „ë‹¬ ë°©ì‹ì´ ìžˆìŠµë‹ˆë‹¤.  

#### ìµœëŒ€ í•œ ë²ˆ (at-most once)

ë©”ì‹œì§€ë¥¼ ìµœëŒ€ í•œ ë²ˆë§Œ ì „ë‹¬í•˜ëŠ” ë°©ì‹ìž…ë‹ˆë‹¤.  
ë©”ì‹œì§€ê°€ ì „ë‹¬ ê³¼ì •ì—ì„œ ì†Œì‹¤ë˜ì–´ë„ ë‹¤ì‹œ ì „ë‹¬ë˜ëŠ” ì¼ì€ ì—†ìŠµë‹ˆë‹¤.  

í”„ë¡œë“€ì„œëŠ” `Ack=0` ì„¤ì •ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ë°œí–‰í•˜ê³  ìˆ˜ì‹ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ì§€ ì•ŠìŠµë‹ˆë‹¤.  
ë©”ì‹œì§€ ì „ë‹¬ì´ ì‹¤íŒ¨í•´ë„ ë‹¤ì‹œ ì‹œë„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.  

ì»¨ìŠˆë¨¸ëŠ” ë©”ì‹œì§€ë¥¼ ì½ê³  ì²˜ë¦¬í•˜ê¸° ì „ì— ì˜¤í”„ì…‹ë¶€í„° ê°±ì‹ í•©ë‹ˆë‹¤.  
ë©”ì‹œì§€ë¥¼ ì²˜ë¦¬í•˜ê¸° ì „ì— ì˜¤í”„ì…‹ì„ ê°±ì‹ í•˜ë¯€ë¡œ ì²˜ë¦¬ ê³¼ì •ì—ì„œ ìž¥ì• /ì˜¤ë¥˜ê°€ ë°œìƒí•  ê²½ìš°, í•´ë‹¹ ë©”ì‹œì§€ë¥¼ ë‹¤ì‹œ ì†Œë¹„í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.  

#### ìµœì†Œ í•œ ë²ˆ (at-least once)

ê°™ì€ ë©”ì‹œì§€ê°€ í•œ ë²ˆ ì´ìƒ ì „ë‹¬ë  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.  
ë©”ì‹œì§€ ì†Œì‹¤ì´ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.  

í”„ë¡œë“€ì„œëŠ” `Ack=1` ë˜ëŠ” `Ack=all` ì„¤ì •ìœ¼ë¡œ ë©”ì‹œì§€ë¥¼ ë°œí–‰í•˜ê³ , ë©”ì‹œì§€ê°€ ë¸Œë¡œì»¤ì— ì •ìƒì ìœ¼ë¡œ ì „ë‹¬ë˜ì—ˆëŠ”ì§€ ë°˜ë“œì‹œ í™•ì¸í•©ë‹ˆë‹¤.  
ë©”ì„¸ì§€ ì „ë‹¬ì´ ì‹¤íŒ¨í•˜ê±°ë‚˜ íƒ€ìž„ì•„ì›ƒì´ ë°œìƒí•œ ê²½ìš°ì—ëŠ” ê³„ì† ìž¬ì‹œë„ í•©ë‹ˆë‹¤.  

ì»¨ìŠˆë¨¸ëŠ” ë©”ì‹œì§€ë¥¼ ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  ì˜¤í”„ì…‹ì„ ê°±ì‹ í•©ë‹ˆë‹¤.  
ë©”ì‹œì§€ ì²˜ë¦¬ ê³¼ì •ì—ì„œ ìž¥ì• /ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì—¬ë„ í•´ë‹¹ ë©”ì‹œì§€ë¥¼ ë‹¤ì‹œ ì†Œë¹„í•©ë‹ˆë‹¤.  
ë‹¨, ë©”ì‹œì§€ë¥¼ ì •ìƒì ìœ¼ë¡œ ì²˜ë¦¬í–ˆìœ¼ë‚˜ ì˜¤í”„ì…‹ ê°±ì‹ ì— ì‹¤íŒ¨í•˜ë©´ ì¤‘ë³µ ì²˜ë¦¬ë  ìˆ˜ ìžˆìœ¼ë¯€ë¡œ ì»¨ìŠˆë¨¸ê°€ ë©±ë“±ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìžˆë„ë¡ êµ¬ì„±í•´ì•¼ í•©ë‹ˆë‹¤.  

#### ì •í™•ížˆ í•œ ë²ˆ (exactly once)

`ì •í™•ížˆ í•œ ë²ˆ (exactly once)`ëŠ” í”„ë¡œë“€ì„œì™€ ì»¨ìŠˆë¨¸ ëª¨ë‘ ë©±ë“±ì„±ì„ ë³´ìž¥í•´ì•¼ í•˜ëŠ” êµ¬í˜„ì´ ê°€ìž¥ ê¹Œë‹¤ë¡œìš´ ë°©ì‹ìž…ë‹ˆë‹¤.  
ë©”ì„¸ì§€ëŠ” ì •í™•ížˆ í•œ ë²ˆ ì „ë‹¬ ë˜ë©° ë©”ì‹œì§€ ì†Œì‹¤ì´ ë°œìƒí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.  

Kafka ê¸°ì¤€ í”„ë¡œë“€ì„œëŠ” `Ack=all`ê³¼ `idempotence=true`, `transactional.id=my-tx-id` ì„¤ì •ìœ¼ë¡œ ë©”ì‹œì§€ì˜ ìœ ì¼ì„±ì„ ë³´ìž¥í•˜ì—¬ ë°œí–‰í•©ë‹ˆë‹¤.  
ë©”ì‹œì§€ íë§Œìœ¼ë¡œ ì •í™•ížˆ í•œ ë²ˆì„ ë³´ìž¥í•˜ê¸° ì–´ë µë‹¤ë©´, `InBox OutBox íŒ¨í„´`ìœ¼ë¡œ ë„ì›€ì„ ì¤„ ìˆ˜ ìžˆìŠµë‹ˆë‹¤.  

`ì •í™•ížˆ í•œ ë²ˆ (exactly once)`ì€ ìŠ¤í„°ë””ì› ë¶„ë“¤ê³¼ ê°€ìž¥ ë§Žì€ ì–˜ê¸°ë¥¼ ë‚˜ëˆŒì •ë„ë¡œ ì‹¤ì œë¡œ ê°€ëŠ¥í•œ ê°œë…ì¸ì§€ ì˜ê²¬ì´ ë¶„ë¶„í–ˆìŠµë‹ˆë‹¤.  
ë³¸ í¬ìŠ¤íŒ…ì„ ìž‘ì„±í•˜ê¸° ìœ„í•œ êµ¬ê¸€ë§ ê³¼ì •ì—ì„œë„ ê´€ë ¨ ë‚´ìš©ìœ¼ë¡œ í† ë¡ í•˜ëŠ” ê²Œì‹œë¬¼ë“¤ì„ ê½¤ ë³¼ ìˆ˜ ìžˆì—ˆìœ¼ë©°, ë¹„í˜„ì‹¤ì ì´ë‹¤. ë¶ˆê°€ëŠ¥í•˜ë‹¤. ë¼ëŠ” ì˜ê²¬ì´ ë‹¬ë¦¬ê¸°ë„ í–ˆìŠµë‹ˆë‹¤.  
ëª¨ë“  ê²ƒì€ íŠ¸ë ˆì´ë“œ ì˜¤í”„ë¥¼ ë™ë°˜í•˜ë¯€ë¡œ `ì •í™•ížˆ í•œ ë²ˆ (exactly once)`ì„ ë‹¬ì„±í•˜ê¸° ìœ„í•´ ê°’ ë¹„ì‹¼ ë¹„ìš©ì„ ì§€ë¶ˆí•´ì•¼í• ì§€ ê³ ë¯¼í•˜ëŠ”ê²Œ ì¤‘ìš”í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.  

> ì•„íŒŒì¹˜ ì¹´í”„ì¹´ Exactly-once ì²˜ë¦¬ì˜ ì§„ì‹¤ê³¼ ê±°ì§“  
> https://blog.voidmainvoid.net/504  
> 
> Kafka Message Delivery Semantics  
> https://kafka.apache.org/documentation/#semantics  
> 
> Exactly-Once Semantics Are Possible: Hereâ€™s How Kafka Does It  
> https://www.confluent.io/blog/exactly-once-semantics-are-possible-heres-how-apache-kafka-does-it/
> 
> Processing guarantees in Kafka  
> https://medium.com/@andy.bryant/processing-guarantees-in-kafka-12dd2e30be0e  
> 
> Overcoming Message Delivery Challenges in Distributed Systems: A Comprehensive Look at Outbox and Inbox Patterns  
> https://medium.com/hprog99/overcoming-message-delivery-challenges-in-distributed-systems-a-comprehensive-look-at-outbox-and-a669e5f21898  
> 
> ì¼ 3,000ë§Œ ê±´ì˜ ë„¤ì´ë²„íŽ˜ì´ ì£¼ë¬¸ ë©”ì‹œì§€ë¥¼ ì²˜ë¦¬í•˜ëŠ” Kafka ì‹œìŠ¤í…œì˜ ë¬´ì¤‘ë‹¨ ì „í™˜ ì‚¬ë¡€  
> https://d2.naver.com/helloworld/9581727  
